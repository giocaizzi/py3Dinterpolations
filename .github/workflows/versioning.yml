name: Versioning

on:
  pull_request:
    types:
      - opened
      - synchronize

jobs:
  check-version-update:
    runs-on: ubuntu-latest
    steps:
      - name: Check Out Code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Verify versions
        run: |
          # Get the commit hashes for the base and head branches
          BASE_SHA=$(git rev-parse origin/${{ github.base_ref }})
          HEAD_SHA=$(git rev-parse origin/${{ github.head_ref }})

          # Check if there are changes in the specific folder
          CHANGED_FILES=$(git diff --name-only $BASE_SHA $HEAD_SHA './py3dinterpolations/')

          if [[ -n "$CHANGED_FILES" ]]; then
            echo "There are changes in the py3dinterpolations folder"

            old_version=$(git show ${{ github.base_ref }}:./py3dinterpolations/__init__.py | grep -oP '__version__ = "\K[^"]+')
            new_version=$(git show ${{ github.head_ref }}:./py3dinterpolations/__init__.py | grep -oP '__version__ = "\K[^"]+')

            if [ "$old_version" != "$new_version" ]; then
              echo "The __version__ variable has been updated."
              exit 0
            else
              echo "Error: The __version__ variable has not been updated in package init."
              exit 1
            fi
          else
            echo "There are no changes in the py3dinterpolations folder"
            exit 0
          fi


